<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <title>Menstruationscyklus – interaktiv prototype</title>
  <!-- googlefont: Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
 
  <style>
  /* ——— BASIS ——— */
  html,body{margin:0;height:100%}
  body{
    display:flex;align-items:center;justify-content:center;
    background:#f9d9e5;
    transition:background .4s ease;
    font-family:"Rubik",system-ui,sans-serif;
  }

  /* ——— RING & LABELS ——— */
  .phase{
    stroke:#b48293;         /* base stroke */
    stroke-width:40;
    fill:none;
    stroke-linecap:butt;
    opacity:.45;
    transition:opacity .25s, filter .25s;
  }
  .label{
    fill:#ffffff;
    font-size:22px;
    font-weight:700;
    letter-spacing:1px;
    text-transform:uppercase;
    user-select:none;
    pointer-events:none;
    opacity:.45;
    transition:opacity .25s, filter .25s;
  }
  .phase.active,
  .label.active{
    opacity:1;
    filter:brightness(.8);
  }

  /* ——— TRÆKKECIRKEL (“HANDLE”) ——— */
  #handleCircle{
    fill:#333;cursor:pointer;touch-action:none;
    transition:transform .2s ease;
  }
  #handleText{
    fill:#fff;font-weight:600;font-size:11px;
    user-select:none;pointer-events:none;
    display:none;
  }
  </style>
</head>

<body>
  <div id="icons"></div>

  <svg id="scene" width="500" height="500" viewBox="0 0 500 500">

    <!-- Midter-ansigt / placeholder -->
    <circle cx="250" cy="250" r="75" fill="#fffbe7" stroke="#e9e2ce" stroke-width="4"/>

    <!-- Ring – fire 90°-buer -->
    <g id="ring">
      <path id="phase0" class="phase"
            d="M250 80 A170 170 0 0 1 420 250"/>
      <path id="phase1" class="phase"
            d="M420 250 A170 170 0 0 1 250 420"/>
      <path id="phase2" class="phase"
            d="M250 420 A170 170 0 0 1 80 250"/>
      <path id="phase3" class="phase"
            d="M80 250  A170 170 0 0 1 250 80"/>
    </g>

    <!-- Buede etiketter -->
    <defs>
      <path id="labelPath0" d="M250 105 A145 145 0 0 1 395 250"/>
      <path id="labelPath1" d="M395 250 A145 145 0 0 1 250 395"/>
      <path id="labelPath2" d="M250 395 A145 145 0 0 1 105 250"/>
      <path id="labelPath3" d="M105 250 A145 145 0 0 1 250 105"/>
    </defs>

    <g id="ring">
      <!-- 0 · Lutealfase  (images/forside/cirkel-fase4.svg) -->
      <image id="phase0" class="phase"
             href="images/forside/cirkel-fase4.svg"
             x="0" y="0" width="500" height="500"
             transform="rotate(0 250 250)"/>
      
      <!-- 1 · Menstruation  (images/forside/cirkel-fase1.svg) -->
      <image id="phase1" class="phase"
             href="images/forside/cirkel-fase1.svg"
             x="0" y="0" width="500" height="500"
             transform="rotate(90 250 250)"/>
      
      <!-- 2 · Follikelfase  (images/forside/cirkel-fase2.svg) -->
      <image id="phase2" class="phase"
             href="images/forside/cirkel-fase2.svg"
             x="0" y="0" width="500" height="500"
             transform="rotate(180 250 250)"/>
      
      <!-- 3 · Ægløsning    (images/forside/cirkel-fase3.svg) -->
      <image id="phase3" class="phase"
             href="images/forside/cirkel-fase3.svg"
             x="0" y="0" width="500" height="500"
             transform="rotate(270 250 250)"/>
    </g>
  </svg>

<script>
/* ——— DATA ——— */
const phases = [
  {name:'Lutealfasen',   color:'#FBE3EF'},
  {name:'Menstruation',  color:'#F9A5B5'},
  {name:'Follikelfasen', color:'#BFE6FF'},
  {name:'Ægløsning',     color:'#FFE4A2'}
];

/* ——— ELEMENTER ——— */
const svg          = document.getElementById('scene');
const handleGroup  = document.getElementById('handle');
const handleCircle = document.getElementById('handleCircle');
const handleText   = document.getElementById('handleText');
const iconsBox     = document.getElementById('icons');

/* ——— GEOMETRI ——— */
const CENTER = {x:250,y:250};
const RADIUS = 170;
const STROKE = 40;
const OUTER_R = RADIUS + STROKE/2 + 40;

/* ——— STATE ——— */
let currentPhaseIdx = null;
let dragging        = false;
let dragMoved       = false;
let dragStartPt     = {x:0,y:0};

/* ——— INIT ——— */
placeHandleAtAngle(0,true);
updateBackground(null);

/* ——— EVENTS ——— */
handleCircle.addEventListener('pointerdown', pointerDown);
handleCircle.addEventListener('click',        onHandleClick);

function pointerDown(e){
  dragging   = true;
  dragMoved  = false;
  dragStartPt = {x:e.clientX,y:e.clientY};
  handleCircle.setPointerCapture(e.pointerId);
  handleCircle.style.transform='scale(.7)';
  handleText.style.display='none';
  document.addEventListener('pointermove', pointerMove);
  document.addEventListener('pointerup',   pointerUp);
}

function pointerMove(e){
  if(!dragging) return;
  if(!dragMoved){
    const dx=e.clientX-dragStartPt.x, dy=e.clientY-dragStartPt.y;
    if(Math.hypot(dx,dy)>3) dragMoved=true;
  }
  const loc = clientToSvg(e.clientX,e.clientY);
  const ang = pointToAngle(loc.x,loc.y);
  placeHandleAtAngle(ang);
  const idx = angleToPhase(ang);
  if(idx!==currentPhaseIdx){highlightPhase(idx);currentPhaseIdx=idx;}
}

function pointerUp(e){
  dragging=false;
  handleCircle.releasePointerCapture(e.pointerId);
  document.removeEventListener('pointermove',pointerMove);
  document.removeEventListener('pointerup',pointerUp);

  const loc  = clientToSvg(e.clientX,e.clientY);
  const dist = pointDist(loc,CENTER);
  const onRing = Math.abs(dist-OUTER_R) < STROKE;

  onRing ? snapToPhase(currentPhaseIdx) : resetToTop();
}

function onHandleClick(){
  if(!dragMoved && handleText.style.display!=="none" && currentPhaseIdx!==null){
    console.log(`Åbn oplevelse for: ${phases[currentPhaseIdx].name}`);
  }
}

/* ——— VISUEL LOGIK ——— */
function placeHandleAtAngle(angle,forceSmall=false){
  const rad = (angle-90)*Math.PI/180;
  handleGroup.setAttribute('transform',
    `translate(${CENTER.x+OUTER_R*Math.cos(rad)},${CENTER.y+OUTER_R*Math.sin(rad)})`);
  if(forceSmall){
    handleCircle.style.transform='scale(.7)';
    handleText.style.display='none';
  }
}

function highlightPhase(idx){
  for(let i=0;i<4;i++){
    document.getElementById(`phase${i}`).classList.toggle('active',i===idx);
    document.getElementById(`label${i}`).classList.toggle('active',i===idx);
  }
  updateBackground(idx);
}

function snapToPhase(idx){
  placeHandleAtAngle(idx*90+45);
  handleCircle.style.transform='scale(1)';
  handleText.style.display='block';
  updateBackground(idx);
}

function resetToTop(){
  currentPhaseIdx = null;
  for(let i=0;i<4;i++){
    document.getElementById(`phase${i}`).classList.remove('active');
    document.getElementById(`label${i}`).classList.remove('active');
  }
  placeHandleAtAngle(0,true);
  updateBackground(null);
}

/* ——— BAGGRUND ——— */
function updateBackground(idx){
  document.body.style.background =
    idx===null ? '#f9d9e5' : phases[idx].color;
}

/* ——— HJÆLPEFUNKTIONER ——— */
function clientToSvg(x,y){
  const pt = svg.createSVGPoint();pt.x=x;pt.y=y;
  return pt.matrixTransform(svg.getScreenCTM().inverse());
}
function pointToAngle(x,y){
  return (Math.atan2(y-CENTER.y,x-CENTER.x)*180/Math.PI+90+360)%360;
}
function angleToPhase(angle){return Math.floor(angle/90)%4;}
function pointDist(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}
</script>
</body>
</html>
